{{ define "head" }}
  {{ partial "jsonld.html" . }}
{{ end }}

{{ define "main" }}
<article class="flex flex-col w-full relative">
  <!-- Hidden Pagefind Image -->
  {{ $heroImg := partial "blog/thumbnail.html" . }}
  {{ $imgType := printf "%T" $heroImg }}
  {{ if or (eq $imgType "*resources.resourceAdapter") (hasPrefix $imgType "*") }}
    {{ if ne $heroImg.MediaType.SubType "svg" }}
      {{ $pagefindImg := $heroImg.Fit "128x128" }}
      <img src="{{ $pagefindImg.RelPermalink }}" alt="{{ .Title }}" class="hidden" data-pagefind-meta="image[src]">
    {{ else }}
      <img src="{{ $heroImg.RelPermalink }}" alt="{{ .Title }}" class="hidden" data-pagefind-meta="image[src]">
    {{ end }}
  {{ end }}

  {{- /* Hero image (unless nohero is true) */ -}}
  {{- if not .Params.nohero -}}
    {{ partial "blog/hero.html" . }}
  {{- end -}}

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
    <div class="flex flex-col lg:flex-row gap-8 lg:pl-24">
      {{- /* Main content column */ -}}
      <div class="flex-1 max-w-3xl">
        {{- /* Article header */ -}}
        <div class="flex flex-col gap-y-4 mt-8">
          {{- /* Meta information row */ -}}
          <div class="flex flex-row justify-between items-center">
            {{ partial "blog/time.html" . }}
            {{ partial "blog/taxonomies.html" . }}
          </div>

          <h1 class="text-4xl lg:text-5xl font-semibold text-gray-800 dark:text-gray-100">
            {{ .Title | .RenderString }}
          </h1>

          <div class="mt-3">
            {{ partial "block/author.html" . }}
          </div>
        </div>

        {{- /* Article content */ -}}
        <div class="mt-8 w-full prose dark:prose-invert prose-quoteless post-content">
          {{ .Content | safeHTML }}
        </div>

        {{- /* Comments */ -}}
        {{ partial "comments.html" . }}
      </div>

      {{- /* Table of contents sidebar */ -}}
      {{- if or .Params.Toc $.Site.Params.Toc -}}
        {{- if ne .Params.Toc false -}}
          <aside class="hidden lg:block w-64 shrink-0 mt-24">
            <div class="sticky top-8">
              <nav class="prose dark:prose-invert prose-sm">
                <h2 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100">{{ T "table_of_contents" }}</h2>
                <div class="text-sm">
                  {{ .TableOfContents }}
                </div>
              </nav>
            </div>
          </aside>
        {{- end -}}
      {{- end -}}
    </div>
  </div>

  {{- /* Related posts section */ -}}
  {{ partial "blog/related.html" . }}

  {{- /* Subscription CTA */ -}}
  {{- if not .Params.hidesubscription -}}
    {{ partial "blog/subscribe.html" . }}
  {{- end -}}
</article>
{{ end }}
