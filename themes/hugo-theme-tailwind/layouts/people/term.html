{{ define "main" }}
<div class="flex flex-col w-full max-w-4xl lg:max-w-5xl">
  <!-- Person Profile Section -->
  <div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-blue-950">
    <div class="flex flex-col md:flex-row gap-6 p-6">
      {{ if .Params.image }}
        {{ $image := .Resources.Get .Params.image }}
        {{ if $image }}
          <div class="flex-shrink-0">
            {{ $baseSize := mul 48 4 }}
            {{ partial "responsive_image_fixed.html" (dict "image" $image "baseWidth" $baseSize "baseHeight" $baseSize "alt" .Title "class" "w-48 h-48 rounded-lg object-cover shadow-md" "method" "fit") }}
          </div>
        {{ end }}
      {{ end }}

      <div class="flex flex-col gap-y-3 flex-grow">
        <h1 class="text-4xl font-medium text-gray-500 dark:text-gray-100">
          {{ .Title }}
        </h1>

        {{ with .Params.role }}
          <p class="text-lg text-gray-600 dark:text-gray-300">
            {{ . }}
          </p>
        {{ end }}

        <!-- Social Links -->
        {{ if or .Params.github .Params.linkedin .Params.bluesky .Params.mastodon .Params.orcid .Params.website }}
          <div class="flex flex-row gap-3 mt-2">
            {{ with .Params.github }}
              <a href="https://github.com/{{ . }}" target="_blank" title="GitHub" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <i class="h-6 w-6 flex-none">{{ partial "icon.html" "brand-github" }}</i>
              </a>
            {{ end }}
            {{ with .Params.linkedin }}
              <a href="https://linkedin.com/in/{{ . }}" target="_blank" title="LinkedIn" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <i class="h-6 w-6 flex-none">{{ partial "icon.html" "brand-linkedin" }}</i>
              </a>
            {{ end }}
            {{ with .Params.bluesky }}
              <a href="https://bsky.app/profile/{{ . }}" target="_blank" title="Bluesky" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <i class="h-6 w-6 flex-none">{{ partial "icon.html" "brand-bluesky" }}</i>
              </a>
            {{ end }}
            {{ with .Params.mastodon }}
              <a href="{{ . }}" target="_blank" title="Mastodon" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <i class="h-6 w-6 flex-none">{{ partial "icon.html" "brand-mastodon" }}</i>
              </a>
            {{ end }}
            {{ with .Params.orcid }}
              <a href="https://orcid.org/{{ . }}" target="_blank" title="ORCID" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <i class="h-6 w-6 flex-none">{{ partial "icon.html" "brand-orcid" }}</i>
              </a>
            {{ end }}
            {{ with .Params.website }}
              <a href="{{ . }}" target="_blank" title="Website" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <i class="h-6 w-6 flex-none">{{ partial "icon.html" "world" }}</i>
              </a>
            {{ end }}
          </div>
        {{ end }}

        {{ if .Content }}
          <div class="prose prose dark:prose-invert max-w-none">
            {{ .Content }}
          </div>
        {{ end }}
      </div>
    </div>
  </div>

  <!-- Software by this Person -->
  {{ $software := where .Pages "Section" "software" }}
  {{ if gt (len $software) 0 }}
    <div class="mt-8 mb-6 mx-2 md:mx-0">
      <h2 class="text-2xl font-medium text-gray-800 dark:text-gray-200 mb-4">
        Software by {{ .Title }}
      </h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mx-2 md:mx-0 mb-6">
      {{ range $software }}
        {{ partial "card_software.html" . }}
      {{ end }}
    </div>
  {{ end }}

  <!-- Events attended by this Person -->
  {{ $events := where .Pages "Section" "events" }}
  {{ if gt (len $events) 0 }}
    <div class="mt-8 mb-6 mx-2 md:mx-0">
      <h2 class="text-2xl font-medium text-gray-800 dark:text-gray-200 mb-4">
        Events attended by {{ .Title }}
      </h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mx-2 md:mx-0 mb-6">
      {{ range $events }}
        {{ partial "card_event.html" . }}
      {{ end }}
    </div>
  {{ end }}

  <!-- Blog Posts and Resources by this Person -->
  {{ $posts := where .Pages "Section" "blog" }}
  {{ $resources := where .Pages "Section" "resources" }}
  {{ $combined := union $posts $resources }}
  {{ if gt (len $combined) 0 }}
    <div class="mt-8 mb-6 mx-2 md:mx-0">
      <h2 class="text-2xl font-medium text-gray-800 dark:text-gray-200 mb-4">
        Posts and resources by {{ .Title }}
      </h2>
    </div>

    <div class="flex flex-col">
      {{ range $combined.ByDate.Reverse }}
        <article class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-blue-950">
          <div>
            <a href="{{ .RelPermalink }}">
              {{ partial "block/image.html" . }}
            </a>
          </div>
          <div class="flex flex-col gap-y-3 p-6">
            <h3 class="text-3xl font-medium text-gray-800 dark:text-gray-200">
              <a href="{{ .RelPermalink }}">{{ .Title | .RenderString }}</a>
            </h3>

            {{ partial "block/desc.html" . }}
            {{ partial "block/taxonomies.html" . }}
            {{ partial "block/time.html" . }}
          </div>
        </article>
      {{ end }}
    </div>
  {{ end }}
</div>
{{ end }}